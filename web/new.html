<html>

<style>
.typed{
	color:lightblue;
}
button{
	display:none;
}
</style>
<body>

<p id="the_sentence">The quick brown fox jumped over the lazy dog.</p>
<textarea></textarea>

<button>Done!</button>

<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
 
<script>
array=$('#the_sentence').text().split("");

var sentence_number = 1;

keymap={8:"Backspace", 9:"Tab", 13:"Enter", 16:"Shift", 17:"Control", 18:"Alt",
    19:"Pause", 20:"CapsLock", 27:"Esc", 32:"Spacebar", 33:"PageUp",
    34:"PageDown", 35:"End", 36:"Home", 37:"Left", 38:"Up", 39:"Right",
    40:"Down", 45:"Insert", 46:"Del",
    // Number keys on main keyboard (not keypad)
    48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",
    65:"A", 66:"B", 67:"C", 68:"D", 69:"E", 70:"F", 71:"G", 72:"H", 73:"I",
    74:"J", 75:"K", 76:"L", 77:"M", 78:"N", 79:"O", 80:"P", 81:"Q", 82:"R",
    83:"S", 84:"T", 85:"U", 86:"V", 87:"W", 88:"X", 89:"Y", 90:"Z", 186:";",
    189:"-", 187:"=", 222:"'", 191:"/", 188:",", 190:"."};


function checkTextArea(sentence){
	if($('textarea').val() == sentence){
    $('button').show();
    $('button').unbind().on('click',nextSentence(sentence_number));
    sentence_number+=1;
  }else{
   $('button').hide();
  }
}

keystrokes=[[],[],[]];


$('textarea').keydown(function(e){
	console.log(Date.now()+" "+keymap[e.which]+" PRESSED");
  keystrokes[sentence_number-1].push(Date.now()+" "+keymap[e.which]+" PRESSED");
  // console.log(Date.now()+" "+e.which+" "+" PRESSED");
	// console.log(e.keyCode);
});

$('textarea').keyup(function(e){
	console.log(Date.now()+" "+keymap[e.which]+" RELEASED");
  keystrokes[sentence_number-1].push(Date.now()+" "+keymap[e.which]+" RELEASED");
	// console.log(e.keyCode);
	checkTextArea($('#the_sentence').text());
});

function nextSentence(val){
  $('textarea').val('');
  $('button').unbind('click');
  if(val==1){
    $('#the_sentence').text("Shall I compare thee to a summ3r's day?!");
  }else if(val==2){
    $('#the_sentence').text("Email me at user@inter.net; thanks!");
  }else{
    subject= window.prompt("What's your full name?");
    $('textarea').unbind();
    
    // Push 'keystrokes' object to Firebase
  }
}

</script>

</body>
</html>